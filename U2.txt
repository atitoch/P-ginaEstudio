# Concepto de segmento

Un segmento es un bus lineal al que están conectadas varias estaciones y que termina en los extremos. Las características son:

· Cuando se tiene una red grande se divide en partes, llamados segmentos a cada uno de ellos.
· Para interconectar varios segmentos se utilizan bridges o routers.
· El rendimiento de una red aumenta al dividirla en segmentos.
· A cada segmento junto a las estaciones a él conectadas se las llama subred.

## Necesidades

Segmentar una intranet consiste en dividirla en subredes para así poder aumentar el número de computadoras conectados a ella y/o el rendimiento de la misma.

Cuando se segmenta una intranet, lo que se esta haciendo es crear subredes pequeñas que, por decirlo de alguna manera, se autogestionan, de forma que la comunicación entre segmentos se realiza cuando es necesario, es decir, cuando un nodo de un segmento quiere comunicarse con un nodo del otro segmento; mientras tanto cada segmento de la intranet está trabajando de forma independiente por lo que en una misma intranet se están produciendo varias comunicaciones de forma simultánea; evidentemente esto mejora el rendimiento de la intranet.

El dispositivo que se utiliza para segmentar una red debe ser inteligente ya que debe ser capaz de decidir hacia qué segmento debe enviar la información llegado a él: si hacia el mismo segmento desde el que la recibió o hacia otro segmento diferente.

Abstrayéndose de algunos detalles, es fácil pensar que segmentar una intranet, ya que se habla de subredes, es como interconectar intranets diferentes. Sin embargo, cuando se habla de segmentar se hace referencia a una única intranet; esto lleva asociado lo siguiente: una única topología, un único tipo de protocolo de comunicaciones, un único entorno de trabajo; cuando se habla de interconectar intranets, en la mayoría de los casos, las intranets tienen como mínimo topologías diferentes. No obstante, sí debe destacarse que los dispositivos que se utilizan para segmentar redes coinciden con algunos de los dispositivos que son utilizados para interconectar redes diferentes.

Dependiendo del tipo de protocolos que se utilicen en la intranet segmentada, así como de dispositivos que se utilicen para realizar esta segmentación puede hacerse necesario o no el atribuir a cada segmento una dirección de red diferente. Cuando se trabaja con protocolos TCP/IP esto no es necesario, basta con que cada estación tenga su propia dirección IP, y que no aparezcan dos estaciones con la misma dirección, independientemente de si están o no en el mismo segmento de la intranet.

Existen diferentes motivos por los que se puede hacer necesario la segmentación de una intranet, como pueden ser:

· **Necesidad de sobrepasar el número de nodos que la topología permite.** La limitación del numero de nodos en una intranet vienen impuesta por varios factores, como son el método de acceso al medio que se utiliza, el tipo de cable, el ancho de banda, etc.

· **Mejorar el rendimiento de una intranet en la que ha aumentado el tráfico.** En ocasiones, una intranet que inicialmente funciona bien, con un tiempo de repuesta aceptable, empieza a perder prestaciones; el motivo es claro: de forma paulatina se ha ido incrementando el número de comunicaciones que la intranet debe gestionar, por diferentes motivos como que los usuarios comienzan a conocer la red y la aprovechan más, o que se han ido instalando más aplicaciones.

Existen diferentes formas de aminorar este problema: Una de ellas, la más drástica es cambiar algún elemento físico de la intranet: por ejemplo sustituir el cable que implementa la intranet por uno que pueda soportar velocidades mayores, cambiar las tarjetas de red por otras más rápidas, e incluso cambiar la topología empleada. Una solución menos concluyente consiste en segmentar la intranet. Dividirla estratégicamente en dos subredes, reduciendo de esta forma el tráfico en cada una de ellas. Por ejemplo, sobre una intranet inicial repartida por varias aulas de un centro, se pueden crear subredes por aula, de forma que en cada aula se mejorará el rendimiento de la red.

La interconexión de intranets se puede establecer a varios niveles: desde el nivel físico, a través de un dispositivo llamado switch (switch) hasta niveles más altos (niveles del modelo OSI) a través de dispositivos como un puente (Bridge) o un router (encaminador). El nivel en el que trabajan los diferentes dispositivos se muestra a continuacion.

Para la segmentación de intranets, y teniendo en cuenta que uno de los motivos por el que se realiza esta operación es mejorar el rendimiento de la red, es necesario emplear dispositivos inteligentes, como pueden ser un ruteador o un puente.

Las redes locales tienen una serie de limitaciones inherentes a su naturaleza:

· Limitaciones en el número de host.
· Limitaciones en la distancia que puede cubrir.
· Limitaciones en el número y tipo de nodos que se pueden conectar.
· Limitaciones en el acceso a los nodos.
· Limitaciones en la comunicación con los usuarios.

Para resolver estos problemas se utilizan soluciones de dos naturalezas: software y hardware:

· Elementos de interconexión.
· Software de servicios.

De forma genérica existen varias maneras de ampliar las intranets:

· **Switch:** Permite interconectar equipos dentro de una red
· **Repetidores:** conexión a nivel físico, en el mismo segmento.
· **Bridges:** Conexión a nivel de enlace entre dos segmentos (iguales o distintos).
· **Routers:** Conexión a nivel de red.
· **Gateways:** Conexión a nivel de presentación, entre dos redes distintas.

## Switch

Un switch es un dispositivo digital lógico de interconexión de redes de computadoras que opera en la capa de enlace de datos del modelo OSI. Su función es interconectar dos o más segmentos de red, de manera similar a los puentes de red, pasando datos de un segmento a otro de acuerdo con la dirección MAC de destino de las tramas en la red.

**Figura 2.1 Switch en el centro de una red en estrella.**

Los switch se utilizan cuando se desea conectar múltiples redes, fusionándolas en una sola. Al igual que los puentes, dado que funcionan como un filtro en la red, mejoran el rendimiento y la seguridad de las redes de área local.

### Interconexión de switch y puentes

Los puentes y switches es una interfaz física usada para conectar redes de cableado estructurado. Tiene ocho pines, usados generalmente como extremos de cables de par trenzado.

Son conectores RJ-45, similares a los RJ-11 pero más anchos. Se utiliza comúnmente en cables de redes Ethernet (8 pines), terminaciones de teléfonos (4 pines), etc.

### Introduccion al funcionamiento de los switch

Los switches poseen la capacidad de aprender y almacenar las direcciones de red de la capa 2 (direcciones MAC) de los dispositivos alcanzables a través de cada uno de sus puertos. Por ejemplo, un equipo conectado directamente a un puerto de un switch provoca que el switch almacene su dirección MAC. Esto permite que, a diferencia de los concentradores, la información dirigida a un dispositivo vaya desde el puerto origen al puerto de destino.

En el caso de conectar dos switches o un switch y un concentrador, cada switch aprenderá las direcciones MAC de los dispositivos accesibles por sus puertos, por lo tanto en el puerto de interconexión se almacenan las MAC de los dispositivos del otro switch.

### Bucles de red e inundaciones de trafico

Como anteriormente se comentaba, uno de los puntos críticos de estos equipos son los bucles, que consisten en habilitar dos caminos diferentes para llegar de un equipo a otro a través de un conjunto de switches. Los bucles se producen porque los switches que detectan que un dispositivo es accesible a través de dos puertos emiten la trama por ambos. Al llegar esta trama al switch siguiente, este vuelve a enviar la trama por los puertos que permiten alcanzar el equipo. Este proceso provoca que cada trama se multiplique de forma exponencial, llegando a producir las denominadas inundaciones de la red, provocando en consecuencia el fallo o caída de las comunicaciones.

## Clasificacion

### Store-and-Forward

Los switches Store-and-Forward guardan cada trama en un búfer antes del intercambio de información hacia el puerto de salida. Mientras la trama está en el búfer, el switch calcula el CRC y mide el tamaño de la misma. Si el CRC falla, o el tamaño es muy pequeño o muy grande (un cuadro Ethernet tiene entre 64 bytes y 1518 bytes) la trama es descartada. Si todo se encuentra en orden es encaminada hacia el puerto de salida.

Este método asegura operaciones sin error y aumenta la confianza de la red. Pero el tiempo utilizado para guardar y chequear cada trama añade un tiempo de demora importante al procesamiento de las mismas. La demora o delay total es proporcional al tamaño de las tramas: cuanto mayor es la trama, más tiempo toma este proceso.

### Cut-Through

Los switches cut-through fueron diseñados para reducir esta latencia. Esos switches minimizan el retardo leyendo sólo los 6 primeros bytes de datos de la trama, que contiene la dirección de destino MAC, e inmediatamente la encaminan.

El problema de este tipo de switch es que no detecta tramas corruptas causadas por colisiones (conocidos como runts), ni errores de CRC. Cuanto mayor sea el número de colisiones en la red, mayor será el ancho de banda que consume al encaminar tramas corruptas.

Existe un segundo tipo de switch cut-through, los denominados fragment free, fue proyectado para eliminar este problema. El switch siempre lee los primeros 64 bytes de cada trama, asegurando que tenga por lo menos el tamaño mínimo, y evitando el encaminamiento de runts por la red.

### Adaptative Cut-Through

Son los switches que procesan tramas en el modo adaptativo y son compatibles tanto con store-and-forward como con cut-through. Cualquiera de los modos puede ser activado por el administrador de la red, o el switch puede ser lo bastante inteligente como para escoger entre los dos métodos, basado en el número de tramas con error que pasan por los puertos.

Cuando el número de tramas corruptas alcanza un cierto nivel, el switch puede cambiar del modo cut-through a store-and-forward, volviendo al modo anterior cuando la red se normalice.

Los switches cut-through son más utilizados en pequeños grupos de trabajo y pequeños departamentos. En esas aplicaciones es necesario un buen volumen de trabajo o throughput, ya que los errores potenciales de red quedan en el nivel del segmento, sin impactar la red corporativa.

Los switches store-and-forward son utilizados en redes corporativas, donde es necesario un control de errores.

## Switches de la capa 2

Son los switches tradicionales, que funcionan como puentes multi-puertos. Su principal finalidad es dividir una LAN en múltiples dominios de colisión, o en los casos de las redes en anillo, segmentar la LAN en diversos anillos. Basan su decisión de envío en la dirección MAC destino que contiene cada trama.

Los switches de la capa 2 posibilitan múltiples transmisiones simultáneas sin interferir en otras sub-redes. Los switches de capa 2 no consiguen, sin embargo, filtrar difusiones o broadcasts, multicasts (en el caso en que más de una sub-red contenga las estaciones pertenecientes al grupo multicast de destino), ni tramas cuyo destino aún no haya sido incluido en la tabla de direccionamiento.

## Switches de la capa 3

Son los switches que, además de las funciones tradicionales de la capa 2, incorporan algunas funciones de enrutamiento o routing, como por ejemplo la determinación del camino basado en informaciones de capa de red (capa 3 del modelo OSI), validación de la integridad del cableado de la capa 3 por checksum y soporte a los protocolos de routing tradicionales (RIP, OSPF, etc)

Los switches de capa 3 soportan también la definición de redes virtuales (VLAN), y según modelos posibilitan la comunicación entre las diversas VLAN sin la necesidad de utilizar un router externo.

Por permitir la unión de segmentos de diferentes dominios de difusión o broadcast, los switches de capa 3 son particularmente recomendados para la segmentación de redes LAN muy grandes, donde la simple utilización de switches de capa 2 provocaría una pérdida de rendimiento y eficiencia de la LAN, debido a la cantidad excesiva de broadcasts.

Se puede afirmar que la implementación típica de un switch de capa 3 es más escalable que un enrutador, pues éste último utiliza las técnicas de enrutamiento a nivel 3 y enrutamiento a nivel 2 como complementos, mientras que los switches sobreponen la función de enrutamiento encima del encaminamiento, aplicando el primero donde sea necesario.

Dentro de los switch de la capa 3 tenemos:

### Paquete por paquete

Básicamente, un switch paquete por paquete (packet by packet en inglés) es un caso especial de un switch Store-and-Forward pues, al igual que este, almacena y examina el paquete, calculando el CRC y decodificando la cabecera de la capa de red para definir su ruta a través del protocolo de enrutamiento adoptado.

### Cut-through

Un switch de la capa 3 Cut-Through (no confundir con un switch Cut-Through), examina los primeros campos, determina la dirección de destino (a través de la información de los headers o cabeceras de capa 2 y 3) y, a partir de ese instante, establece una conexión punto a punto (a nivel 2) para conseguir una alta tasa de transferencia de paquetes.

Cada fabricante tiene su diseño propio para posibilitar la identificación correcta de los flujos de datos. Como ejemplo, tenemos el "IP Switching" de Ipsilon, el "SecureFast Virtual Networking" de Cabletron, el "Fast IP" de 3Com.

El único proyecto adoptado como un estándar de hecho, implementado por diversos fabricantes, es el MPOA (Multi Protocol Over ATM). El MPOA, en deterioro de su comprobada eficiencia, es complejo y bastante caro de implementar, y limitado en cuanto a backbones ATM.

Además, un switch Layer 3 Cut-Through, a partir del momento en que la conexión punto a punto es establecida, podrá funcionar en el modo "Store-and-Forward" o "Cut-Through"

## Switches de la capa 4

Están en el mercado hace poco tiempo y hay una controversia en relación con la clasificación adecuada de estos equipos. Muchas veces son llamados de Layer 3+ (Layer 3 Plus).

Básicamente, incorporan a las funcionalidades de un switch de la capa 3; la habilidad de implementar la políticas y filtros a partir de informaciones de la capa 4 o superiores, como puertos TCP/UDP, SNMP, FTP, etc.

## Store and Forward

**Imagen 2.2 Representación gráfica de la transferencia de un paquete.**

Almacenamiento y reenvío (en inglés: «Store and forward») es una técnica de conmutación en redes con conexiones punto a punto estáticas, en virtud de la cual los datos se envían a un nodo intermedio, donde son retenidos temporalmente hasta su posterior reenvío, bien a su destino final, bien a otro nodo intermedio. Cada nodo intermedio se encarga de verificar la integridad del mensaje antes de transferirlo al siguiente nodo.

Esta técnica se aplicó como tecnología de conmutación en las primeras redes de área amplia (WAN), y más tarde en las primeras multicomputadoras (con redes estáticas). En general, es adecuada para redes tolerantes al retardo (DTN, de «delay-tolerant networks»), donde no se proporciona ningún tipo de servicio en tiempo real, concretamente en escenarios donde los nodos se hallan geográficamente distantes, no existe conectividad directa o la red sufre una elevada tasa de errores.

### Funcionamiento

La unidad de transferencia entre interfaces (nivel de red del modelo OSI) es el paquete, mientras que la unidad de transferencia entre controladores de enlace (nivel físico) es el phit (de «physical unit»). Un phit es la unidad de información transferida por un enlace en un ciclo de red.

En una red basada en «almacenamiento y reenvío», un switch espera a recibir íntegramente el paquete antes de ejecutar el algoritmo de encaminamiento. Una vez hecho esto, el paquete completo se transfiere o reenvía al siguiente switch, determinado por el encaminamiento, a través de la salida correspondiente. En cada instante, el paquete puede estar transfiriéndose por un único canal. De lo anterior se deduce que los recursos de red (buffer y enlaces) se asignan a nivel de paquete.

El buffer del switch debe tener capacidad para almacenar todo el paquete completo. En una red de procesamiento paralelo, el recurso a la memoria principal del nodo al que se conecta el switch no es una opción viable, ya que degrada considerablemente las prestaciones. Por ello, es preciso limitar ante todo el tamaño de los paquetes, dividiendo en la interfaz origen el mensaje en unidades más pequeñas que no superen un tamaño máximo preestablecido.

En multiprocesadores esta división puede ser superflua, ya que la longitud del mensaje suele estar ajustada al tamaño de una línea de caché.

En el nivel de interfaz de red, el mensaje se descompone en unidades más pequeñas, de modo que distintas partes del mensaje puedan transferirse en paralelo por la red siguiendo uno o varios caminos. Cuanto menor sea el tamaño de los paquetes, mayor grado de paralelismo podrá alcanzarse en la transferencia de los datos, menor capacidad de almacenamiento se requerirá en los buffers de los switches y menor retraso conllevará el bloqueo de un paquete. Como contrapartida, el envío de cabeceras supone una sobrecarga dentro de la transferencia global del mensaje, además del tiempo añadido que requiere la división del mensaje en las interfaces de red, tanto mayor cuanto mayor sea el número de paquetes necesarios.

### Ancho de banda

El ancho de banda de una red depende del número de canales que puedan estar transfiriendo información simultáneamente. Este número dependerá de la cantidad de enlaces que ocupe un paquete bloqueado; estos enlaces no podrán transferir datos mientras dure el bloqueo, lo que mermará la productividad global de la red.

Si en un momento dado un paquete no puede acceder a un recurso, se bloquea. Esto implica que un cierto número de enlaces quedarán ocupados por el paquete bloqueado, permaneciendo inutilizados mientras dure el bloqueo. Estos enlaces ocupados pueden a su vez provocar el bloqueo de otros paquetes y, en última instancia, causar un bloqueo en cadena y saturar la red. El problema puede solventarse en parte usando en los switches un almacenamiento común a todas las entradas, de forma que el bloqueo de paquetes no impida la entrada de nuevos paquetes (siempre que haya espacio disponible en el buffer para ellos).

### Costos

La capacidad de almacenamiento de los switches repercute directamente en su coste. En este caso, el tamaño del buffer asociado a los puertos de entrada o salida será múltiplo de un paquete. Por tanto, el costo de los switches basados en esta técnica generalmente será superior al de otros procedimientos que empleen una unidad de asignación inferior al paquete.

## Conmutación Virtual Cut-Through

La conmutación cut-through (en inglés: "Cut-through switching") más conocida como virtual cut-through es una técnica de conmutación de paquetes según la cual el switch empieza a retransmitir una trama o paquete antes de haberlo recibido por completo, normalmente al identificar la dirección del nodo destino.

Si los switches de la red implementan conmutación adaptativa (adaptive switching), pueden alternar selectivamente entre un modo de operación cut-through y otro de tipo store-and-forward ("almacenamiento y reenvío"), dependiendo de las condiciones que presente la red en cada momento. Este mecanismo permite optimizar las prestaciones de la red al combinar la alta velocidad de transferencia de virtual cut-through (cuando la tasa de errores es baja) con la fiabilidad que proporciona «store-and-forward» (cuando la tasa de errores aumenta).

### Funcionamiento

Al igual que en conmutación vermiforme, en una red que opera con virtual cut-through el encaminamiento en el switch se ejecuta en cuanto llega la cabecera del paquete. La unidad de transferencia entre interfaces (nivel de red del modelo OSI) es el paquete, que puede "cortarse" (cut-through) en trozos más pequeños, de forma que la cabecera pueda estar ya en el siguiente switch cuando aún no se ha recibido el paquete completo.

Si un paquete se bloquea por hallarse ocupado un enlace, puede entretanto almacenarse en el buffer a la entrada del switch, cuya capacidad debe ser suficiente para alojar (al menos) un paquete completo. Esto implica que, si los mensajes no tienen un tamaño máximo preestablecido, deberán fragmentarse en unidades más pequeñas. De esta forma, en virtual cut-through el camino a recorrer por los paquetes se segmenta en etapas, al igual que sucede en conmutación vermiforme, pero asignando buffer y enlaces a nivel de paquete como en «almacenamiento y reenvío». Este esquema permite que, en cada momento, un paquete no bloqueado pueda estar transfiriéndose por múltiples canales de la red al mismo tiempo.

### Ancho de banda

El ancho de banda de una red depende del número de canales que puedan estar transfiriendo información simultáneamente. Este número dependerá de la cantidad de enlaces que ocupe un paquete bloqueado; estos enlaces no podrán transferir datos mientras dure el bloqueo, lo que mermará la productividad global de la red.

Si en un momento dado un paquete no puede acceder a un recurso (i.e. el puerto de salida del switch por el que debe encaminarse), se bloquea. Esto implica que un cierto número de enlaces quedarán ocupados por el paquete bloqueado, permaneciendo inutilizados mientras dure el bloqueo. Estos enlaces ocupados pueden a su vez provocar el bloqueo de otros paquetes y, en última instancia, causar un bloqueo en cadena y saturar la red. El problema puede solventarse en parte usando en los switches un almacenamiento común a todas las entradas, de forma que el bloqueo de paquetes no impida la entrada de nuevos paquetes (siempre que haya espacio disponible en el buffer para ellos).

### Costos

La capacidad de almacenamiento de los switches repercute directamente en su costo. En este caso, el tamaño del buffer asociado a los puertos de entrada o salida será múltiplo de un paquete, al igual que en «almacenamiento y reenvío».

### Ventajas

· En comparación con «almacenamiento y reenvío», esta técnica reduce el tiempo de paso por el switch, aunque a costa de la fiabilidad (no se verifica la integridad de los paquetes, luego podrían transferirse paquetes de datos corruptos).
· No necesita almacenar el paquete completo en el buffer para empezar a transmitir, lo que aumenta el rendimiento.

## Conmutación sin fragmentos

La conmutación sin fragmentos también se conoce como conmutación sin runtless y es un híbrido de conmutación de corte y de almacenamiento y reenvío. La conmutación sin fragmentos se desarrolló para resolver el problema de la colisión tardía.

**NOTA**
Recuerde que cuando las transmisiones de dos sistemas ocurren al mismo tiempo, el resultado es una colisión. Las colisiones son parte de las comunicaciones Ethernet y no implican ninguna condición de error. Una colisión tardía es similar a una colisión Ethernet, excepto que se produce después de que todos los hosts de la red deberían haber podido darse cuenta de que un host ya estaba transmitiendo. Una colisión tardía indica que otro sistema intentó transmitir después de que un host haya transmitido al menos los primeros 60 bytes de su trama. Las colisiones tardías a menudo se deben a que una LAN Ethernet es demasiado grande y, por lo tanto, necesita ser segmentada. Las colisiones tardías también pueden deberse a dispositivos de red defectuosos en el segmento y a discrepancias dúplex (por ejemplo, semidúplex/dúplex completo) entre los dispositivos conectados.

### Funcionamiento de conmutación sin fragmentos

La conmutación sin fragmentos funciona como la conmutación de corte, con la excepción de que un switch en modo sin fragmentos almacena los primeros 64 bytes de la trama antes de reenviarla. La conmutación sin fragmentos puede verse como un compromiso entre la conmutación de almacenamiento y reenvío y la conmutación de corte. La razón por la que la conmutación sin fragmentos almacena solo los primeros 64 bytes de la trama es que la mayoría de los errores y colisiones de red ocurren durante los primeros 64 bytes de una trama.

**NOTA**
Diferentes métodos funcionan mejor en diferentes puntos de la red. Por ejemplo, la conmutación de corte es mejor para el núcleo de la red, donde los errores son menores y la velocidad es de suma importancia. El almacenamiento y reenvío es mejor en la capa de acceso a la red, donde se encuentran la mayoría de los problemas de red y los usuarios.

## Conmutación de capa 3

La conmutación de capa 3 es otro ejemplo de conmutación sin fragmentos. Hasta ahora, esta discusión se ha concentrado en la conmutación y el puente en la capa de enlace de datos (Capa 2) del modelo de interconexión de sistemas abiertos (OSI). Cuando se desarrolló por primera vez la tecnología de puentes, no era práctico construir puentes de velocidad de cable con un gran número de puertos de alta velocidad debido al costo de fabricación involucrado. Con la mejora de la tecnología, muchas funciones que antes se implementaban en el software se trasladaron al hardware, lo que aumentó el rendimiento y permitió a los fabricantes construir switches de velocidad de cable a precios razonables.

Mientras que los puentes y switches funcionan en la capa de enlace de datos (capa 2 OSI), los enrutadores funcionan en la capa de red (capa 3 OSI). Los routers proporcionan una funcionalidad más allá de la que ofrecen los puentes o los switches.

Los primeros días del enrutamiento involucraban una computadora y dos tarjetas NIC, no muy diferente a dos personas que tenían una conversación, pero tenían que pasar por una tercera persona para hacerlo. La estación de trabajo enviaría su tráfico a través del cable, y el equipo de enrutamiento lo recibiría en una NIC, determinaría que el tráfico tendría que enviarse a la otra NIC y, a continuación, reenviaría el tráfico a esta otra NIC.

**NOTA**
De la misma manera que un switch de capa 2 es otro nombre para un puente, un switch de capa 3 es otro nombre para un router. Esto no quiere decir que un switch de capa 3 y un enrutador funcionen de la misma manera. Los switches de capa 3 toman decisiones basadas en las direcciones de protocolo de Internet (IP) a nivel de puerto, mientras que los routers toman decisiones basadas en un mapa de la red de capa 3 (mantenido en una tabla de enrutamiento).

La conmutación multicapa es una técnica de conmutación que conmuta tanto en la capa de enlace de datos (capa 2 OSI) como en la capa de red (capa 3 OSI). Para habilitar la conmutación multicapa, los switches LAN deben utilizar técnicas de almacenamiento y reenvío porque el switch debe recibir toda la trama antes de realizar cualquier operación de capa de protocolo.

De manera similar a un switch de almacenamiento y reenvío, con la conmutación multicapa, el switch extrae toda la trama recibida en su memoria y calcula su CRC. A continuación, determina si el marco es bueno o malo. Si el CRC calculado en el paquete coincide con el CRC calculado por el switch, se lee la dirección de destino y la trama se reenvía al puerto correcto del switch. Si el CRC no coincide con la trama, la trama se descarta. Debido a que este tipo de conmutación espera a que se reciba toda la trama antes de reenviarse, los tiempos de latencia de los puertos pueden llegar a ser altos, lo que puede dar lugar a cierta latencia o retraso del tráfico de red.

### Operación de conmutación de capa 3

Es posible que se pregunte: "¿Cuál es la diferencia entre un switch de capa 3 y un enrutador?" La diferencia fundamental entre un switch de capa 3 y un ruteador es que los switches de capa 3 tienen hardware optimizado que pasa el tráfico de datos tan rápido como los switches de capa 2. Sin embargo, los switches de capa 3 toman decisiones sobre cómo transmitir el tráfico en la capa 3, al igual que lo hace un router.

**NOTA**
Dentro del entorno LAN, un switch de capa 3 suele ser más rápido que un ruteador porque se basa en hardware de conmutación. Tenga en cuenta que el switch de capa 3 no es tan versátil como un ruteador, por lo que no descarte el uso de un enrutador en su LAN sin examinar primero los requisitos de su LAN, como el uso de la traducción de direcciones de red (NAT).

Antes de continuar con esta discusión, recuerde los siguientes puntos:

1. Un switch es un dispositivo de capa 2 (enlace de datos) con puertos físicos y que el switch se comunica a través de tramas que se colocan en el cable en la capa 1 (física).
2. Un router es un dispositivo de capa 3 (red) que se comunica con otros routers con el uso de paquetes, que a su vez están encapsulados dentro de tramas.

Los routers tienen interfaces para la conexión en el medio de red. Para que un router enrute datos a través de Ethernet.

La función principal del router es determinar la mejor ruta de red en una red compleja. Un router tiene tres formas de aprender sobre las redes y tomar la decisión sobre la mejor ruta: a través de puertos conectados localmente, entradas de ruta estática y protocolos de enrutamiento dinámico. El router utiliza esta información aprendida para tomar una determinación mediante el uso de protocolos de ruteo. Algunos de los protocolos de enrutamiento más comunes utilizados incluyen el protocolo de información de enrutamiento (RIP), el protocolo de ruta más corta abierta primero (OSPF), el protocolo de enrutamiento de puerta de enlace interior (IGRP) y el protocolo de puerta de enlace fronteriza (BGP).

## VLAN

Una VLAN (acrónimo de virtual LAN, «red de área local virtual») es un método de crear redes lógicas e independientes dentro de una misma red física. Varias VLANs pueden coexistir en un único switch físico o en una única red física. Son útiles para reducir el tamaño del dominio de difusión y ayudan en la administración de la red separando segmentos lógicos de una red de área local (como departamentos de una empresa) que no deberían intercambiar datos usando la red local (aunque podrían hacerlo a través de un enrutador o un switch de capa 3 y 4).

Una VLAN consiste en una red de computadoras que se comportan como si estuviesen conectados al mismo switch, aunque pueden estar en realidad conectados físicamente a diferentes segmentos de una red de área local. Los administradores de red configuran las VLANs mediante software en lugar de hardware, lo que las hace extremadamente flexibles. Una de las mayores ventajas de las VLANs surge cuando se traslada físicamente algún ordenador a otra ubicación: puede permanecer en la misma VLAN sin necesidad de cambiar la configuración IP de la máquina.

### Historia

A principios de los años ochenta Ethernet ya era una tecnología consolidada que ofrecía una velocidad de 10 Mbits/s, mucho mayor que gran parte de las alternativas de la época. Las redes Ethernet tenían una topología en bus, donde el medio físico de transmisión (cable coaxial) era compartido. Ethernet era, por lo tanto, una red de difusión y como tal cuando dos estaciones transmiten simultáneamente se producen colisiones y se desperdicia ancho de banda en transmisiones fallidas.

El diseño de Ethernet no ofrecía escalabilidad, es decir, al aumentar el tamaño de la red disminuyen sus prestaciones o el costo se hace inasumible. CSMA/CD, el protocolo que controla el acceso al medio compartido en Ethernet, impone de por sí limitaciones en cuanto al ancho de banda máximo y a la máxima distancia entre dos estaciones. Conectar múltiples redes Ethernet era por aquel entonces complicado, y aunque se podía utilizar un router para la interconexión, estos eran caros y requería un mayor tiempo de procesado por paquete grande, aumentando el retardo.

Para solucionar estos problemas, Dr. W. David Sincoskie inventó el switch Ethernet con auto-aprendizaje, dispositivo de conmutación de tramas de nivel 2. Usar switches para interconectar redes Ethernet permite separar dominios de colisión, aumentando la eficiencia y la escalabilidad de la red. Una red tolerante a fallos y con un nivel alto de disponibilidad requiere que se usen topologías redundantes: enlaces múltiples entre switches y equipos redundantes. De esta manera, ante un fallo en un único punto es posible recuperar de forma automática y rápida el servicio. Este diseño redundante requiere la habilitación del protocolo spanning tree (STP) para asegurarse de que sólo haya activo un camino lógico para ir de un nodo a otro y evitar así el fenómeno conocido como tormentas broadcast. El principal inconveniente de esta topología lógica de la red es que los switches centrales se conviereten en cuellos de botella, pues la mayor parte del tráfico circula a través de ellos.

Sincoskie consiguió aliviar la sobrecarga de los switches inventado LANs virtuales al añadir una etiqueta a las tramas Ethernet con la que diferenciar el tráfico. Al definir varias LANs virtuales cada una de ellas tendrá su propio spanning tree y se podrá asignar los distintos puertos de un switch a cada una de las VLANs. Para unir VLANs que están definidas en varios switches se puede crear un enlace especial llamado trunk, por el que fluye tráfico de varias VLANs. Los switches sabrán a qué VLAN pertenece cada trama observando la etiqueta VLAN (definida en la norma IEEE 802.1Q). Aunque hoy en día el uso de LANs virtuales es generalizado en las redes Ethernet modernas, usarlas para el propósito original puede ser un tanto extraño, ya que lo habitual es utilizarlas para separar dominios de difusión (hosts que pueden ser alcanzados por una trama broadcast).

### Clasificación

Aunque las más habituales son las VLANs basadas en puertos (nivel 1), las redes de área local virtuales se pueden clasificar en cuatro tipos según el nivel de la jerarquía OSI en el que operen:

• **VLAN de nivel 1 (por puerto).** También conocida como "port switching". Se especifica qué puertos del switch pertenencen a la VLAN, los miembros de dicha VLAN son los que se conecten a esos puertos. No permite la movilidad de los usuarios, habría que reconfigurar las VLANs si el usuario se mueve físicamente. Es la más común y la que se explica en profundidad en este artículo.

• **VLAN de nivel 2 por direcciones MAC.** Se asignan hosts a una VLAN en función de su dirección MAC. Tiene la ventaja de que no hay que reconfigurar el dispositivo de conmutación si el usuario cambia su localización, es decir, se conecta a otro puerto de ese u otro dispositivo. El principal inconveniente es que si hay cientos de usuarios habría que asignar los miembros uno a uno.

• **VLAN de nivel 2 por tipo de protocolo.** La VLAN queda determinada por el contenido del campo tipo de protocolo de la trama MAC. Por ejemplo, se asociaría VLAN 1 al protocolo IPv4, VLAN 2 al protocolo IPv6, VLAN 3 a AppleTalk, VLAN 4 a IPX.

• **VLAN de nivel 3 por direcciones de subred (subred virtual).** La cabecera de nivel 3 se utiliza para mapear la VLAN a la que pertenece. En este tipo de VLAN son los paquetes, y no las estaciones, quienes pertenecen a la VLAN. Estaciones con múltiples protocolos de red (nivel 3) estarán en múltiples VLANs.

• **VLAN de niveles superiores.** Se crea una VLAN para cada aplicación: FTP, flujos multimedia, correo electrónico. La pertenencia a una VLAN puede basarse en una combinación de factores como puertos, direcciones MAC, subred, hora del día...

### Redes institucionales

Actualmente, las redes institucionales y corporativas modernas suelen estar configuradas de forma jerárquica dividiéndose en varios grupos de trabajo. Razones de seguridad y confidencialidad aconsejan también limitar el ámbito del tráfico de difusión para que un usuario no autorizado no pueda acceder a recursos o a información que no le corresponde. Por ejemplo, la red institucional de un campus universitario suele separar los usuarios en tres grupos: alumnos, profesores y administración. Cada uno de estos grupos constituye un dominio de difusión, una VLAN, y se suele corresponder asimismo con una subred IP diferente. De esta manera la comunicación entre miembros del mismo grupo se puede hacer en nivel 2, y los grupos están aislados entre sí, sólo se pueden comunicar a través de un router.

La definición de múltiples VLANs y el uso de enlaces trunk, frente a las redes LAN interconectadas con un router, es una solución escalable. Si se deciden crear nuevos grupos se pueden acomodar fácilmente las nuevas VLANs haciendo una redistribución de los puertos de los switches. Además, la pertenencia de un miembro de la comunidad universitaria a una VLAN es independiente de su ubicación física. E incluso se puede lograr que un equipo pertenezca a varias VLANs (mediante el uso de una tarjeta de red que soporte trunk).

Imagine que la Institucion tiene una red con un rango de direcciones IP del tipo 172.16.XXX.0/24, cada VLAN, definida en la capa de enlace de datos (nivel 2 de OSI), se corresponderá con una subred IP distinta: 
- VLAN 10. Administración. Subred IP 172.16.10.0/24 
- VLAN 20. Profesores. Subred IP 172.16.20.0/24 
- VLAN 30. Alumnos. Subred IP 172.16.30.0/24

En cada edificio del instituto hay un switch denominado de acceso, porque a él se conectan directamente los sistemas finales. Los switches de acceso están conectados con enlaces trunk (enlace que transporta tráfico de las tres VLANs) a un switch troncal, de grandes prestaciones, típicamente Gigabit Ethernet o 10-Gigabit Ethernet. Este switch está unido a un router también con un enlace trunk, el router es el encargado de llevar el tráfico de una VLAN a otra.

### Comandos IOS

A continuación se presentan a modo de ejemplo los comandos IOS para configurar los switches y routeres del escenario anterior.

Creamos las VLANs en el switch troncal, suponemos que este switch actúa de servidor y se sincroniza con el resto:
```
Switch-troncal> enable
Switch-troncal# configure terminal
Switch-troncal(config)# vlan database
Switch-troncal(config-vlan)# vlan 10 name administracion
Switch-troncal(config-vlan)# vlan 20 name profesores
Switch-troncal(config-vlan)# vlan 30 name alumnos
Switch-troncal(config-vlan)# exit
```

Definimos como puertos trunk los cuatro del switch troncal:

```
Switch-troncal(config)# interface range g0/0 -3
Switch-troncal(config-if-range)# switchport
Switch-troncal(config-if-range)# switchport mode trunk
Switch-troncal(config-if-range)# switchport trunk native vlan 10
Switch-troncal(config-if-range)# switchport trunk allowed vlan 20, 30
Switch-troncal(config-if-range)# exit
```

Ahora habría que definir en cada switch de acceso qué rango de puertos dedicamos a cada VLAN. Vamos a suponer que se utilizan las interfaces f0/0-15 para la vlan adminstracion, f0/16,31 para vlan profesores y f0/32-47 para la vlan alumnos.

```
Switch-1(config)# interface range f0/0 -15
Switch-1(config-if-range)# switchport
Switch-1(config-if-range)# switchport mode access
Switch-1(config-if-range)# switchport mode access
Switch-1(config-if-range)# switchport access vlan 10
Switch-1(config-if-range)# exit

Switch-1(config)# interface range f0/16 -31
Switch-1(config-if-range)# switchport
Switch-1(config-if-range)# switchport mode access
Switch-1(config-if-range)# switchport access vlan 20
Switch-1(config-if-range)# exit

Switch-1(config)# interface range f0/32 -47
Switch-1(config-if-range)# switchport
Switch-1(config-if-range)# switchport mode access
Switch-1(config-if-range)# switchport access vlan 30
Switch-1(config-if-range)# exit
```

Definimos como trunk el puerto que conecta cada switch de acceso con el troncal:

```
Switch-1(config)# interface g0/0
Switch-1(config-if)# switchport
Switch-1(config-if)# switchport mode trunk
Switch-1(config-if)# switchport trunk native vlan 10
Switch-1(config-if)# switchport trunk allowed vlan 20,30
Switch-1(config-if)# exit
```

En el router creamos una subinterfaz por cada VLAN transportada en el enlace trunk:

```
Router(config)# interface f2
Router(config-if)# no ip address
Router(config-if)# exit

Router(config)# interface f2.1
Router(config-if)# encapsulation dot1q 10 native
Router(config-if)# ip address 172.16.10.1 255.255.255.0
Router(config-if)# exit

Router(config)# interface f2.2
Router(config-if)# encapsulation dot1q 20
Router(config-if)# ip address 172.16.20.1 255.255.255.0
Router(config-if)# exit

Router(config)# interface f2.3
Router(config-if)# encapsulation dot1q 30
Router(config-if)# ip address 172.16.30.1 255.255.255.0
Router(config-if)# exit
```

Esta sería la configuración relativa a la creación de las VLANs, se omite la configuración de otros elementos como los hosts, routers y otros dispositivos de red.

## Las VLAN

Una VLAN es una agrupación lógica de dispositivos o usuarios que se pueden agrupar por función, departamento o aplicación, sin importar la ubicación física del segmento. La configuración de la VLAN se realiza en el switch a través del software. Las VLAN no están estandarizadas y requieren el uso de software propietario del fabricante del switch.

Una LAN típica se configura según la infraestructura física que conecta. Los usuarios se agrupan según su ubicación en relación con el switch o hub al que están conectados y según cómo el cable se tiende al centro del cableado. El router que interconecta cada switch o hub compartido normalmente proporciona segmentación y puede actuar como firewall de broadcast. Los segmentos creados por los switches no lo hacen. La segmentación tradicional de las LAN no agrupa a los usuarios según su asociación de grupo de trabajo o necesidad de ancho de banda. Por lo tanto, comparten el mismo segmento y ocupan el mismo ancho de banda, aunque los requisitos de ancho de banda varían enormemente por grupo de trabajo o departamento.

### Segmentación con arquitecturas de conmutación

Las LAN se dividen cada vez con mayor frecuencia en grupos de trabajo conectados mediante backbones comunes para formar topologías VLAN. Las VLAN segmentan lógicamente la infraestructura física de las LAN en diferentes subredes (o dominios de broadcast para Ethernet). Las tramas de broadcast se conmutan sólo entre puertos dentro de la misma VLAN.

Las primeras implementaciones de VLAN ofrecían una función de asignación de puertos que establecía un dominio de broadcast entre un grupo de dispositivos por defecto. Los requisitos actuales de la red exigen la funcionalidad de VLAN que cubre toda la red. Este enfoque de las VLAN permite agrupar usuarios separados por grandes distancias físicas en topologías virtuales que abarcan toda la red. Las configuraciones VLAN agrupan a los usuarios por asociación lógica, en lugar de por ubicación física.

La mayoría de las redes actualmente instaladas ofrecen una segmentación lógica muy limitada. Los usuarios se agrupan normalmente según las conexiones al switch o hub compartido y los puertos de router entre los switch o hubs. Esta topología brinda segmentación sólo entre los switch o hubs, que normalmente se ubican en pisos separados, y no entre usuarios conectados al mismo switch o hub. Esto impone restricciones físicas en la red y limita la manera en que los usuarios se pueden agrupar. Algunas arquitecturas de hub compartido tienen cierta capacidad de agrupación, pero limitan la forma en que se pueden configurar los grupos de trabajo definidos lógicamente.

### Diferencias entre las LAN conmutadas tradicionales y las VLAN

En una LAN que utiliza dispositivos de conmutación LAN, la tecnología VLAN es una manera económica y eficiente de agrupar usuarios de la red en grupos de trabajo virtuales, más allá de su ubicación física en la red. Algunas de las diferencias principales son las siguientes:

• Las VLAN funcionan a nivel de Capa 2,3 y Capa 4 del modelo de referencia OSI.
• La comunicación entre las VLAN es implementada por el enrutamiento de Capa 3.
• Las VLAN proporcionan un método para controlar los broadcasts de red.
• El administrador de la red asigna usuarios a una VLAN.
• Las VLAN pueden aumentar la seguridad de la red, definiendo cuáles son los nodos de red que se pueden comunicar entre sí.

Mediante la tecnología VLAN, se pueden agrupar los puertos de switch y sus usuarios conectados en grupos de trabajo lógicamente definidos, como los siguientes:

• Compañeros de trabajo en el mismo departamento
• Un equipo de producción interfuncional
• Diferentes grupos de usuarios que comparten la misma aplicación de red o software.

Se pueden agrupar estos puertos y usuarios en grupos de trabajo con un solo switch o switches conectados. Al agrupar los puertos y los usuarios a través de múltiples switches, las VLAN pueden abarcar infraestructuras contenidas en un solo edificio, edificios conectados entre sí o aun redes de área amplia (WAN).

### Transporte de las VLAN a través de backbones

Lo que es importante en cualquier arquitectura de VLAN es la capacidad para transportar información de la VLAN entre switches interconectados y los routers que residen en el backbone corporativo. Estas capacidades de transporte:

• eliminan las fronteras físicas entre los usuarios
• aumentan la flexibilidad de la configuración de una solución de VLAN cuando los usuarios se desplazan
• proporcionan mecanismos de interoperabilidad entre los componentes del sistema de backbone.

El backbone normalmente funciona como el punto de reunión de grandes volúmenes de tráfico. También transporta información del usuario final de la VLAN y su identificación entre switches, routers y servidores directamente conectados. Dentro del backbone, los enlaces de alto ancho de banda y alta capacidad se seleccionan normalmente para transportar el tráfico en toda la empresa.

### El papel de los routers en las VLAN

El papel tradicional de un router es proporcionar firewalls, administración de broadcast y procesamiento y distribución de rutas. Si bien los switches VLAN asumen algunas de estas tareas, los routers siguen siendo vitales para las arquitecturas VLAN porque proporcionan rutas conectadas entre VLAN diferentes. También se conectan a otras partes de la red que están lógicamente segmentadas con el enfoque más tradicional de subredes o requieren el acceso a sitios remotos a través de enlaces de área amplia. La comunicación de Capa 3, ya sea incorporada en el switch o proporcionada externamente, es una parte integral de cualquier arquitectura de conmutación de alto rendimiento.

Se pueden integrar routers externos de forma económica en la arquitectura de conmutación utilizando una o más conexiones de backbone de alta velocidad. Normalmente estas son conexiones Fast Ethernet o ATM, y brindan ventajas:

• Aumentando el rendimiento entre switches y routers
• Consolidando la cantidad total de puertos de router físicos requeridos para la comunicación entre VLAN.

La arquitectura VLAN no sólo proporciona segmentación lógica, sino que, con planificación cuidadosa, puede mejorar considerablemente la eficiencia de la red.

## Implementación de VLAN

### Relación entre puertos, VLAN y broadcasts

Una VLAN forma una red conmutada lógicamente segmentada por funciones, equipos de proyectos o aplicaciones, sin tener en cuenta la ubicación física de los usuarios. Cada puerto de switch se puede asignar a una VLAN. Los puertos asignados a la misma VLAN comparten broadcasts. Los puertos que no pertenecen a esa VLAN no comparten esos broadcasts. Esto mejora el rendimiento general de la red. Las siguientes secciones hacen referencia a tres métodos de implementación de VLAN que se pueden usar para asignar un puerto de switch a una VLAN. Ellos son:

• de puerto central
• estática
• dinámica

### Cómo las VLAN de puerto central facilitan el trabajo del administrador

En las VLAN de puerto central, a todos los nodos conectados a puertos en la misma VLAN se les asigna el mismo identificador de VLAN. El gráfico muestra la pertenencia a la VLAN por puerto, lo que facilita el trabajo del administrador y hace que la red sea más eficiente porque:

• Los usuarios se asignan por puerto.
• Las VLAN son de fácil administración.
• Proporciona mayor seguridad entre las VLAN.
• Los paquetes no se "filtran" a otros dominios.

### VLAN estáticas

Las VLAN estáticas son puertos en un switch que se asignan estáticamente a una VLAN. Estos puertos mantienen sus configuraciones de VLAN asignadas hasta que se cambien. Aunque las VLAN estáticas requieren que el administrador haga los cambios, este tipo de red es segura, de fácil configuración y monitoreo. Las VLAN estáticas funcionan bien en las redes en las que el movimiento se encuentra controlado y administrado.

### VLAN dinámicas

Las VLAN dinámicas son puertos en un switch que pueden determinar automáticamente sus asignaciones de VLAN. Las funciones de las VLAN dinámicas se basan en las direcciones MAC, direccionamiento lógico o tipo de protocolo de los paquetes de datos. Cuando una estación se encuentra inicialmente conectada a un puerto de switch no asignado, el switch correspondiente verifica la entrada de direcciones MAC en la base de datos de administración de la VLAN y configura dinámicamente el puerto con la configuración de VLAN correspondiente. Los principales beneficios de este enfoque son una necesidad de administración menor en el centro de cableado, cuando se agrega o desplaza un usuario y la notificación centralizada cuando se agrega un usuario no reconocido en la red. Normalmente, se necesita una mayor cantidad de administración en un primer momento para configurar la base de datos dentro del software de administración de la VLAN y para mantener una base de datos exacta de todos los usuarios de la red.

## LAN virtuales

### Filtrado de trama

El filtrado de trama es una técnica que examina información específica acerca de cada trama. El concepto de filtrado de trama es muy similar al que normalmente utilizan los routers. Se desarrolla una tabla de filtrado para cada switch; esto proporciona un alto nivel de control administrativo porque puede examinar muchos atributos de cada trama. Según la sofisticación del switch LAN, puede agrupar los usuarios según las direcciones MAC de una estación, tipos de protocolo de capa de red o tipos de aplicación. Las entradas de tabla se comparan con las tramas filtradas por el switch. El switch toma las medidas adecuadas según las entradas.

### Etiquetado de tramas

La identificación de tramas (etiquetado de tramas) asigna de forma exclusiva un identificador definido por el usuario a cada trama. Esta técnica fue elegida por el grupo de estándares de IEEE debido a su escalabilidad.

La identificación de trama de VLAN es un enfoque que se ha desarrollado específicamente para las comunicaciones conmutadas. Este enfoque coloca un identificador exclusivo en el encabezado de cada trama a medida que se envía por todo el backbone de la red. El identificador es comprendido y examinado por cada switch antes de enviar cualquier broadcast o transmisión a otros switches, routers o dispositivos de estación final. Cuando la trama sale del backbone de la red, el switch elimina el identificador antes de que la trama se transmita a la estación final objetivo. La identificación de trama funciona a nivel de Capa 2 y requiere poco procesamiento o gasto administrativo.

## VLAN Trunking Protocol

VTP son las siglas de VLAN Trunking Protocol, un protocolo de mensajes de nivel 2 usado para configurar y administrar VLANs en equipos Cisco. Permite centralizar y simplificar la administración en un domino de VLANs, pudiendo crear, borrar y renombrar las mismas, reduciendo así la necesidad de configurar la misma VLAN en todos los nodos. El protocolo VTP nace como una herramienta de administración para redes de cierto tamaño, donde la gestión manual se vuelve inabordable.

VTP opera en 3 modos distintos:

• **Servidor**
• **Cliente**
• **Transparente**

### Servidor

Es el modo por defecto. Desde él se pueden crear, eliminar o modificar VLANs. Su cometido es anunciar su configuración al resto de switches del mismo dominio VTP y sincronizar dicha configuración con la de otros servidores, basándose en los mensajes VTP recibidos a través de sus enlaces trunk. Debe haber al menos un servidor. Se recomienda autenticación MD5.

### Cliente

En este modo no se pueden crear, eliminar o modificar VLANs, tan sólo sincronizar esta información basándose en los mensajes VTP recibidos de servidores en el propio dominio. Un cliente VTP sólo guarda la información de la VLAN para el dominio completo mientras el switch está activado. Un reinicio del switch borra la información de la VLAN.

### Transparente

Desde este modo tampoco se pueden crear, eliminar o modificar VLANs que afecten a los demás switches. La información VLAN en los switches que trabajen en este modo sólo se puede modificar localmente. Su nombre se debe a que no procesa las actualizaciones VTP recibidas, tan sólo las reenvía a los switches del mismo dominio.

Los administradores cambian la configuración de las VLANs en el switch en modo servidor. Después de realizar cambios, estos son distribuidos a todos los demás dispositivos en el dominio VTP a través de los enlaces permitidos en el trunk (VLAN 1, por defecto), lo que minimiza los problemas causados por las configuraciones incorrectas y las inconsistencias. Los dispositivos que operan en modo transparente no aplican las configuraciones VLAN que reciben, ni envían las suyas a otros dispositivos. Sin embargo, aquellos que usan la versión 2 del protocolo VTP, enviarán la información que reciban (publicaciones VTP) a otros dispositivos a los que estén conectados con una frecuencia de 5 minutos. Los dispositivos que operen en modo cliente, automáticamente aplicarán la configuración que reciban del dominio VTP. En este modo no se podrán crear VLANs, sino que sólo se podrá aplicar la información que reciba de las publicaciones VTP.

Para que dos equipos que utilizan VTP puedan compartir información sobre VLAN, es necesario que pertenezcan al mismo dominio. Los switches descartan mensajes de otro dominio VTP.

Las configuraciones VTP en una red son controladas por un número de revisión. Si el número de revisión de una actualización recibida por un switch en modo cliente o servidor es más alto que la revisión anterior, entonces se aplicará la nueva configuración. De lo contrario se ignoran los cambios recibidos. Cuando se añaden nuevos dispositivos a un dominio VTP, se deben resetear los números de revisión de todo el dominio VTP para evitar conflictos. Se recomienda tener mucho cuidado al usar VTP cuando haya cambios de topología, ya sean lógicos o físicos.

Realmente no es necesario resetear todos los números de revisión del dominio. Sólo hay que asegurarse de que los switches nuevos que se agregen al dominio VTP tengan números de revisión más bajos que los que están configurados en la red. Si no fuese así, bastaría con eliminar el nombre del dominio del switch que se agrega. Esa operación vuelve a poner a cero su contador de revisión.

El VTP sólo aprende sobre las VLAN de rango normal (ID de VLAN 1 a 1005). Las VLAN de rango extendido (ID mayor a 1005) no son admitidas por el VTP. El VTP guarda las configuraciones de la VLAN en la base de datos de la VLAN, denominada vlan.dat.

### Seguridad VTP

VTP puede operar sin autenticación, en cuyo caso resulta fácil para un atacante falsificar paquetes VTP para añadir, cambiar o borrar la información sobre las VLANs. Existen herramientas disponibles gratuitamente para realizar esas operaciones. Debido a eso se recomienda establecer un password para el dominio VTP y usarlo en conjunto con la función hash MD5 para proveer autenticación a los paquetes VTP. Resulta de vital importancia para los enlaces troncales de la VLAN.

### Mensajes VTP

Los paquetes VTP se pueden enviar tanto en tramas Inter-Switch Link (ISL) como en tramas IEEE 802.1Q (dot1q). El formato de los paquetes VTP encapsulados en tramas ISL es el siguiente:

En el caso de paquetes VTP encapsulados en dot1q, tanto la cabecera ISL (ISL Header) como CRC son sustituidos por etiquetas dot1q. Por otro lado, salvo el formato de la cabecera VTP (VTP Header), que puede variar, todos los paquetes VTP contienen los siguientes campos en la cabecera:

• Versión del protocolo VTP: 1, 2 o 3
• Tipos de mensaje VTP:
  • Resumen de advertencias
  • Subconjunto de advertencias
  • Peticiones de advertencias
  • Mensajes de unión VTP
• Longitud del dominio de control
• Nombre del dominio de control

### Numero de configuraciones de revisión

El número de configuración de revisión es un número de 32 bits que indica el nivel de revisión del paquete VTP. Cada nodo VTP rastrea el número deEsta sería la configuración relativa a la creación de las VLANs, se omite la configuración de otros elementos como los hosts, routers y otros dispositivos de red.

## Las VLAN

Una VLAN es una agrupación lógica de dispositivos o usuarios que se pueden agrupar por función, departamento o aplicación, sin importar la ubicación física del segmento. La configuración de la VLAN se realiza en el switch a través del software. Las VLAN no están estandarizadas y requieren el uso de software propietario del fabricante del switch.

Una LAN típica se configura según la infraestructura física que conecta. Los usuarios se agrupan según su ubicación en relación con el switch o hub al que están conectados y según cómo el cable se tiende al centro del cableado. El router que interconecta cada switch o hub compartido normalmente proporciona segmentación y puede actuar como firewall de broadcast. Los segmentos creados por los switches no lo hacen. La segmentación tradicional de las LAN no agrupa a los usuarios según su asociación de grupo de trabajo o necesidad de ancho de banda. Por lo tanto, comparten el mismo segmento y ocupan el mismo ancho de banda, aunque los requisitos de ancho de banda varían enormemente por grupo de trabajo o departamento.

### Segmentación con arquitecturas de conmutación

Las LAN se dividen cada vez con mayor frecuencia en grupos de trabajo conectados mediante backbones comunes para formar topologías VLAN. Las VLAN segmentan lógicamente la infraestructura física de las LAN en diferentes subredes (o dominios de broadcast para Ethernet). Las tramas de broadcast se conmutan sólo entre puertos dentro de la misma VLAN.

Las primeras implementaciones de VLAN ofrecían una función de asignación de puertos que establecía un dominio de broadcast entre un grupo de dispositivos por defecto. Los requisitos actuales de la red exigen la funcionalidad de VLAN que cubre toda la red. Este enfoque de las VLAN permite agrupar usuarios separados por grandes distancias físicas en topologías virtuales que abarcan toda la red. Las configuraciones VLAN agrupan a los usuarios por asociación lógica, en lugar de por ubicación física.

La mayoría de las redes actualmente instaladas ofrecen una segmentación lógica muy limitada. Los usuarios se agrupan normalmente según las conexiones al switch o hub compartido y los puertos de router entre los switch o hubs. Esta topología brinda segmentación sólo entre los switch o hubs, que normalmente se ubican en pisos separados, y no entre usuarios conectados al mismo switch o hub. Esto impone restricciones físicas en la red y limita la manera en que los usuarios se pueden agrupar. Algunas arquitecturas de hub compartido tienen cierta capacidad de agrupación, pero limitan la forma en que se pueden configurar los grupos de trabajo definidos lógicamente.

### Diferencias entre las LAN conmutadas tradicionales y las VLAN

En una LAN que utiliza dispositivos de conmutación LAN, la tecnología VLAN es una manera económica y eficiente de agrupar usuarios de la red en grupos de trabajo virtuales, más allá de su ubicación física en la red. Algunas de las diferencias principales son las siguientes:

• Las VLAN funcionan a nivel de Capa 2,3 y Capa 4 del modelo de referencia OSI.
• La comunicación entre las VLAN es implementada por el enrutamiento de Capa 3.
• Las VLAN proporcionan un método para controlar los broadcasts de red.
• El administrador de la red asigna usuarios a una VLAN.
• Las VLAN pueden aumentar la seguridad de la red, definiendo cuáles son los nodos de red que se pueden comunicar entre sí.

Mediante la tecnología VLAN, se pueden agrupar los puertos de switch y sus usuarios conectados en grupos de trabajo lógicamente definidos, como los siguientes:

• Compañeros de trabajo en el mismo departamento
• Un equipo de producción interfuncional
• Diferentes grupos de usuarios que comparten la misma aplicación de red o software.

Se pueden agrupar estos puertos y usuarios en grupos de trabajo con un solo switch o switches conectados. Al agrupar los puertos y los usuarios a través de múltiples switches, las VLAN pueden abarcar infraestructuras contenidas en un solo edificio, edificios conectados entre sí o aun redes de área amplia (WAN).

### Transporte de las VLAN a través de backbones

Lo que es importante en cualquier arquitectura de VLAN es la capacidad para transportar información de la VLAN entre switches interconectados y los routers que residen en el backbone corporativo. Estas capacidades de transporte:

• eliminan las fronteras físicas entre los usuarios
• aumentan la flexibilidad de la configuración de una solución de VLAN cuando los usuarios se desplazan
• proporcionan mecanismos de interoperabilidad entre los componentes del sistema de backbone.

El backbone normalmente funciona como el punto de reunión de grandes volúmenes de tráfico. También transporta información del usuario final de la VLAN y su identificación entre switches, routers y servidores directamente conectados. Dentro del backbone, los enlaces de alto ancho de banda y alta capacidad se seleccionan normalmente para transportar el tráfico en toda la empresa.

### El papel de los routers en las VLAN

El papel tradicional de un router es proporcionar firewalls, administración de broadcast y procesamiento y distribución de rutas. Si bien los switches VLAN asumen algunas de estas tareas, los routers siguen siendo vitales para las arquitecturas VLAN porque proporcionan rutas conectadas entre VLAN diferentes. También se conectan a otras partes de la red que están lógicamente segmentadas con el enfoque más tradicional de subredes o requieren el acceso a sitios remotos a través de enlaces de área amplia. La comunicación de Capa 3, ya sea incorporada en el switch o proporcionada externamente, es una parte integral de cualquier arquitectura de conmutación de alto rendimiento.

Se pueden integrar routers externos de forma económica en la arquitectura de conmutación utilizando una o más conexiones de backbone de alta velocidad. Normalmente estas son conexiones Fast Ethernet o ATM, y brindan ventajas:

• Aumentando el rendimiento entre switches y routers
• Consolidando la cantidad total de puertos de router físicos requeridos para la comunicación entre VLAN.

La arquitectura VLAN no sólo proporciona segmentación lógica, sino que, con planificación cuidadosa, puede mejorar considerablemente la eficiencia de la red.

## Implementación de VLAN

### Relación entre puertos, VLAN y broadcasts

Una VLAN forma una red conmutada lógicamente segmentada por funciones, equipos de proyectos o aplicaciones, sin tener en cuenta la ubicación física de los usuarios. Cada puerto de switch se puede asignar a una VLAN. Los puertos asignados a la misma VLAN comparten broadcasts. Los puertos que no pertenecen a esa VLAN no comparten esos broadcasts. Esto mejora el rendimiento general de la red. Las siguientes secciones hacen referencia a tres métodos de implementación de VLAN que se pueden usar para asignar un puerto de switch a una VLAN. Ellos son:

• de puerto central
• estática
• dinámica

### Cómo las VLAN de puerto central facilitan el trabajo del administrador

En las VLAN de puerto central, a todos los nodos conectados a puertos en la misma VLAN se les asigna el mismo identificador de VLAN. El gráfico muestra la pertenencia a la VLAN por puerto, lo que facilita el trabajo del administrador y hace que la red sea más eficiente porque:

• Los usuarios se asignan por puerto.
• Las VLAN son de fácil administración.
• Proporciona mayor seguridad entre las VLAN.
• Los paquetes no se "filtran" a otros dominios.

### VLAN estáticas

Las VLAN estáticas son puertos en un switch que se asignan estáticamente a una VLAN. Estos puertos mantienen sus configuraciones de VLAN asignadas hasta que se cambien. Aunque las VLAN estáticas requieren que el administrador haga los cambios, este tipo de red es segura, de fácil configuración y monitoreo. Las VLAN estáticas funcionan bien en las redes en las que el movimiento se encuentra controlado y administrado.

### VLAN dinámicas

Las VLAN dinámicas son puertos en un switch que pueden determinar automáticamente sus asignaciones de VLAN. Las funciones de las VLAN dinámicas se basan en las direcciones MAC, direccionamiento lógico o tipo de protocolo de los paquetes de datos. Cuando una estación se encuentra inicialmente conectada a un puerto de switch no asignado, el switch correspondiente verifica la entrada de direcciones MAC en la base de datos de administración de la VLAN y configura dinámicamente el puerto con la configuración de VLAN correspondiente. Los principales beneficios de este enfoque son una necesidad de administración menor en el centro de cableado, cuando se agrega o desplaza un usuario y la notificación centralizada cuando se agrega un usuario no reconocido en la red. Normalmente, se necesita una mayor cantidad de administración en un primer momento para configurar la base de datos dentro del software de administración de la VLAN y para mantener una base de datos exacta de todos los usuarios de la red.

## LAN virtuales

### Filtrado de trama

El filtrado de trama es una técnica que examina información específica acerca de cada trama. El concepto de filtrado de trama es muy similar al que normalmente utilizan los routers. Se desarrolla una tabla de filtrado para cada switch; esto proporciona un alto nivel de control administrativo porque puede examinar muchos atributos de cada trama. Según la sofisticación del switch LAN, puede agrupar los usuarios según las direcciones MAC de una estación, tipos de protocolo de capa de red o tipos de aplicación. Las entradas de tabla se comparan con las tramas filtradas por el switch. El switch toma las medidas adecuadas según las entradas.

### Etiquetado de tramas

La identificación de tramas (etiquetado de tramas) asigna de forma exclusiva un identificador definido por el usuario a cada trama. Esta técnica fue elegida por el grupo de estándares de IEEE debido a su escalabilidad.

La identificación de trama de VLAN es un enfoque que se ha desarrollado específicamente para las comunicaciones conmutadas. Este enfoque coloca un identificador exclusivo en el encabezado de cada trama a medida que se envía por todo el backbone de la red. El identificador es comprendido y examinado por cada switch antes de enviar cualquier broadcast o transmisión a otros switches, routers o dispositivos de estación final. Cuando la trama sale del backbone de la red, el switch elimina el identificador antes de que la trama se transmita a la estación final objetivo. La identificación de trama funciona a nivel de Capa 2 y requiere poco procesamiento o gasto administrativo.

## VLAN Trunking Protocol

VTP son las siglas de VLAN Trunking Protocol, un protocolo de mensajes de nivel 2 usado para configurar y administrar VLANs en equipos Cisco. Permite centralizar y simplificar la administración en un domino de VLANs, pudiendo crear, borrar y renombrar las mismas, reduciendo así la necesidad de configurar la misma VLAN en todos los nodos. El protocolo VTP nace como una herramienta de administración para redes de cierto tamaño, donde la gestión manual se vuelve inabordable.

VTP opera en 3 modos distintos:

• **Servidor**
• **Cliente**
• **Transparente**

### Servidor

Es el modo por defecto. Desde él se pueden crear, eliminar o modificar VLANs. Su cometido es anunciar su configuración al resto de switches del mismo dominio VTP y sincronizar dicha configuración con la de otros servidores, basándose en los mensajes VTP recibidos a través de sus enlaces trunk. Debe haber al menos un servidor. Se recomienda autenticación MD5.

### Cliente

En este modo no se pueden crear, eliminar o modificar VLANs, tan sólo sincronizar esta información basándose en los mensajes VTP recibidos de servidores en el propio dominio. Un cliente VTP sólo guarda la información de la VLAN para el dominio completo mientras el switch está activado. Un reinicio del switch borra la información de la VLAN.

### Transparente

Desde este modo tampoco se pueden crear, eliminar o modificar VLANs que afecten a los demás switches. La información VLAN en los switches que trabajen en este modo sólo se puede modificar localmente. Su nombre se debe a que no procesa las actualizaciones VTP recibidas, tan sólo las reenvía a los switches del mismo dominio.

Los administradores cambian la configuración de las VLANs en el switch en modo servidor. Después de realizar cambios, estos son distribuidos a todos los demás dispositivos en el dominio VTP a través de los enlaces permitidos en el trunk (VLAN 1, por defecto), lo que minimiza los problemas causados por las configuraciones incorrectas y las inconsistencias. Los dispositivos que operan en modo transparente no aplican las configuraciones VLAN que reciben, ni envían las suyas a otros dispositivos. Sin embargo, aquellos que usan la versión 2 del protocolo VTP, enviarán la información que reciban (publicaciones VTP) a otros dispositivos a los que estén conectados con una frecuencia de 5 minutos. Los dispositivos que operen en modo cliente, automáticamente aplicarán la configuración que reciban del dominio VTP. En este modo no se podrán crear VLANs, sino que sólo se podrá aplicar la información que reciba de las publicaciones VTP.

Para que dos equipos que utilizan VTP puedan compartir información sobre VLAN, es necesario que pertenezcan al mismo dominio. Los switches descartan mensajes de otro dominio VTP.

Las configuraciones VTP en una red son controladas por un número de revisión. Si el número de revisión de una actualización recibida por un switch en modo cliente o servidor es más alto que la revisión anterior, entonces se aplicará la nueva configuración. De lo contrario se ignoran los cambios recibidos. Cuando se añaden nuevos dispositivos a un dominio VTP, se deben resetear los números de revisión de todo el dominio VTP para evitar conflictos. Se recomienda tener mucho cuidado al usar VTP cuando haya cambios de topología, ya sean lógicos o físicos.

Realmente no es necesario resetear todos los números de revisión del dominio. Sólo hay que asegurarse de que los switches nuevos que se agregen al dominio VTP tengan números de revisión más bajos que los que están configurados en la red. Si no fuese así, bastaría con eliminar el nombre del dominio del switch que se agrega. Esa operación vuelve a poner a cero su contador de revisión.

El VTP sólo aprende sobre las VLAN de rango normal (ID de VLAN 1 a 1005). Las VLAN de rango extendido (ID mayor a 1005) no son admitidas por el VTP. El VTP guarda las configuraciones de la VLAN en la base de datos de la VLAN, denominada vlan.dat.

### Seguridad VTP

VTP puede operar sin autenticación, en cuyo caso resulta fácil para un atacante falsificar paquetes VTP para añadir, cambiar o borrar la información sobre las VLANs. Existen herramientas disponibles gratuitamente para realizar esas operaciones. Debido a eso se recomienda establecer un password para el dominio VTP y usarlo en conjunto con la función hash MD5 para proveer autenticación a los paquetes VTP. Resulta de vital importancia para los enlaces troncales de la VLAN.

### Mensajes VTP

Los paquetes VTP se pueden enviar tanto en tramas Inter-Switch Link (ISL) como en tramas IEEE 802.1Q (dot1q). El formato de los paquetes VTP encapsulados en tramas ISL es el siguiente:

En el caso de paquetes VTP encapsulados en dot1q, tanto la cabecera ISL (ISL Header) como CRC son sustituidos por etiquetas dot1q. Por otro lado, salvo el formato de la cabecera VTP (VTP Header), que puede variar, todos los paquetes VTP contienen los siguientes campos en la cabecera:

• Versión del protocolo VTP: 1, 2 o 3
• Tipos de mensaje VTP:
  • Resumen de advertencias
  • Subconjunto de advertencias
  • Peticiones de advertencias
  • Mensajes de unión VTP
• Longitud del dominio de control
• Nombre del dominio de control

### Numero de configuraciones de revisión

El número de configuración de revisión es un número de 32 bits que indica el nivel de revisión del paquete VTP. Cada nodo VTP rastrea el número de configuración de revisión que le ha sido asignado. La mayoría de paquetes VTP contienen el número de configuración de revisión del emisor.

La información que aporta el número de configuración de revisión se usa para saber si la información recibida es más reciente que la actual. Cada vez que hay un cambio en la configuración de la VLAN en algún dispositivo VTP del dominio, el número de configuración de revisión se incrementa en una unidad. Para resetearlo, basta con cambiar el nombre del dominio VTP y después restablecerlo.

### Publicación de resúmenes

Los switches Catalyst emiten, por defecto, publicaciones resumidas que informan a los demás switches del nombre actual del dominio VTP, así como de su número de revisión.

Cuando un switch recibe un paquete de resumen, compara su propio nombre de dominio VTP con el recibido. Si el nombre es diferente ignora el paquete, y si es igual, compara el número de revisión propio con el recibido. Si el número de revisión es menor o igual, ignora el paquete, y si no, envía una solicitud de publicación (ya que el switch está desactualizado).

El formato de los paquetes de resumen es el siguiente:

La siguiente lista aclara los campos del paquete de publicación de resúmenes:

• El campo **Followers** (seguidores) indica que el paquete precede a un paquete de publicación de subconjunto.
• El campo **Updater Identity** (identidad del actualizador) es la dirección IP del último switch que incrementó el número de configuración de revisión.
• El campo **Update Timestamp** (sello de momento de actualización) indica la fecha y la hora del último incremento del número de configuración de revisión.
• El campo **Message Digest 5** (algoritmo MD5) porta la contraseña VTP, si se configura y usa MD5 para autenticar la validación de una actualización VTP.

### Publicaciones de subconjuntos

Cuando se cambia la configuración VLAN en un switch, éste incrementa el número de revisión y envía una publicación de resumen. A una publicación de resumen le pueden seguir una o más publicaciones de subconjunto, que contienen una lista de información referente a VLANs. Si hay varias VLANs, se puede requerir más de una publicación para informar a todas ellas.

El formato de los paquetes de subconjunto es el siguiente:

Este ejemplo muestra que los campos de información VLAN son exclusivos de cada VLAN:

Hay dos aclaraciones pertinentes respecto a los campos del paquete:

• El campo **Code** (código) tiene un formato de 0x02 para publicaciones de subconjunto.
• El campo **Sequence number** (número de secuencia) contiene el número de secuencia (que empieza por 1) del paquete en el flujo de paquetes tras una publicación de resumen.

### Solicitudes de publicación

Un switch necesita solicitar publicaciones VTP en las siguientes situaciones:

• El switch ha sido reseteado.
• El nombre del dominio VTP ha sido cambiado.
• El switch ha recibido una publicación de resumen cuyo número de revisión es mayor que el suyo propio.

Cuando un nodo VTP recibe una solicitud de publicación, envía una publicación de resumen y, como se ha descrito antes, una o más publicaciones de subconjunto.

Por ejemplo:

• En este caso, el campo **Code** (código) tiene un formato de 0x03 para solicitudes de publicación.
• El campo **Start value** (valor de comienzo) se usa cuando hay varios subconjuntos.

### VTP Pruning (poda)

El protocolo VTP trata de asegurar que todos los switches del dominio están al tanto de lo que sucede en todas las VLANs. No obstante, hay situaciones en las que VTP genera tráfico innecesario. Todos los envíos unicast desconocidos y broadcast inundan la VLAN entera. Estos últimos son recibidos por todos los switches de la red incluso habiendo pocos usuarios conectados a la VLAN. La poda VTP (pruning) se usa para filtrar este tráfico innecesario.

El siguiente gráfico muestra el tráfico broadcast en una red sin poda:

Los puertos 1 y 2 de los switches A y D respectivamente están asignados a la VLAN roja. Si una trama broadcast se envía desde algún host conectado al switch A, éste reenvía dicha trama a todos los switches de la red (inundación, flooding), recibiéndola incluso los switches C, E y F, que no tienen puertos asignados a la VLAN roja.

En contraposición, el gráfico siguiente muestra los beneficios del pruning:

En este caso, el tráfico broadcast del switch A no es reenviado a los switches C, E y F, ya que el tráfico de la VLAN roja ha sido filtrado en los puertos 4 y 5 de los switches D y B respectivamente.

Cuando está habilitada la poda VTP en un servidor VTP, lo está para todo el dominio. Cabe destacar que el tráfico de las VLANs 1002-1005 no puede ser podado (filtrado).

### Sobre el uso de VTP

El modo por defecto de los switches es el de servidor VTP. Se recomienda el uso de este modo para redes de pequeña escala en las que la información de las VLANs es pequeña y por tanto de fácil almacenamiento en las NVRAMs de los switches.

En redes de mayor tamaño, el administrador debe elegir qué switches actúan como servidores, basándose en las capacidades de éstos (los mejor equipados serán servidores y los demás, clientes).

### Configuración VTP

Los comandos IOS más utilizados para la configuración de un dominio VTP son los siguientes:

```bash
Switch#vlan database
```
Selecciona el modo de creación y edición de VLANs.

```bash
Switch(vlan)#vtp domain nombre-dominio
```
Nombre del dominio VTP.

```bash
Switch(vlan)#vtp [mode] {server | client | transparent}
```
Selección del modo VTP del switch.

```bash
Switch(vlan)#vtp pruning
```
Permite la poda en el dominio VTP.

```bash
Switch#show vtp status
```
Permite verificar la configuración del dominio VTP.

```bash
Switch(config-if)# switchport mode trunk
```
Configura un puerto en modo trunk.

```bash
Switch(config-if)# switchport trunk native vlan 2
```
Configura la VLAN como predeterminada.

```bash
Switch(config-if)# switchport trunk {allowed | pruning} vlan [add|all|except|remove] vlan-list
```
Configura las VLANs permitidas (allowed) o filtradas (pruning).

---

## ANEXO: CÁLCULO DE SUBREDES

### INTRODUCCIÓN

Aunque los materiales didácticos del CCNA son de una excelente calidad, en nuestra opinión. Se anexan ciertos contenidos complementarios dadas las necesidades específicas de un curso a distancia. El presente documento ejemplifica con detalle el proceso del cálculo de subredes, una destreza que todo experto en redes debe manejar con soltura.

Dado su carácter complementario, este anexo está pensado para ser estudiado una vez que haya concluido la preparación del módulo 10 del CCNA 1 y más específicamente la sección 10.3.

El problema del cálculo de subredes normalmente se aborda desde dos posibles planteamientos iniciales:

• Dada una dirección de red, se nos pide segmentarla en un número determinado de subredes.
• O bien, dada una dirección de red queremos subredes con suficientes IPs para un número determinado de hosts.

Este punto de partida puede aplicarse a redes de clase A, B o C.

### SEGMENTACIÓN EN UN NÚMERO DADO DE SUBREDES

#### RED DE CLASE A

**Ejemplo 1: Segmentación de una IP de clase A usando un octeto.**

Supongamos que disponemos de la dirección de red 75.0.0.0/8 y se nos pide dividirla en 9 subredes.

Como usted ya sabe, en una red de clase A el primer octeto se dedica para el direccionamiento de red y los tres restantes para el direccionamiento de equipos. Por este motivo la máscara de red para el tipo A es de la forma:

**Máscara de red en binario**
```
11111111 00000000 00000000 00000000
```

En la máscara de red los bits con valor 1 significan que se usan para dirección de red y los bits con valor 0 para dirección de host. Lo habitual es escribir las máscaras de red, al igual que las direcciones IPs, en formato decimal:

**Máscara de red en decimal**
```
255 0 0 0
```

Cuando queremos segmentar una dirección de red, tenemos que tomar prestados bits de la dirección de host para direccionar las subredes. Estos bits se toman de izquierda a derecha, de modo que los bits de subred queden contiguos a los bits de la dirección de red.

Por consiguiente, el primer paso es averiguar cuántos bits he de tomar prestados. Para ello escriba el número de subredes pedidas en binario. En nuestro caso son nueve.

| Notación decimal | Notación binaria |
|------------------|------------------|
| 9                | 1001             |

Ahora cuente cuántas cifras ha necesitado para escribir 9 como número binario. Este valor, en nuestro caso cuatro, será el número de bits que habremos de utilizar para realizar la segmentación.

Partíamos de la dirección de red 75.0.0.0/8. Esta IP escrita en binario es:

| Bits de red | Bits de host |
|-------------|--------------|
| 01001011    | 00000000 00000000 00000000 |

Ahora debemos usar los cuatro primeros bits del segundo octeto para direccionar las subredes:

| Red      | Subred | Host |
|----------|--------|------|
| 01001011 | ssss   | 0000 00000000 00000000 |

Hemos representado los bits de la subred con eses. Observe las posibles combinaciones de esos cuatro bits:

| Nº Subred | Dirección binaria |
|-----------|-------------------|
| 1         | 0000              |
| 2         | 0001              |
| 3         | 0010              |
| 4         | 0011              |
| 5         | 0100              |
| 6         | 0101              |
| 7         | 0110              |
| 8         | 0111              |
| 9         | 1000              |
| 10        | 1001              |
| 11        | 1010              |
| 12        | 1011              |
| 13        | 1100              |
| 14        | 1101              |
| 15        | 1110              |
| 16        | 1111              |

Es decir, con cuatro bits tenemos 16 posibles combinaciones. Es fácil recordarlo con la siguiente fórmula:

**2⁴ = 16**

En general:
**2ᵇ = número de combinaciones.**

Donde b es el número de bits que tomamos prestados.

Sin embargo, de todas las combinaciones posibles para las direcciones de subred, se descartan la primera y la última con el fin de no confundirlas con la propia dirección de red y con la dirección de difusión. Por tanto:

**Número de combinaciones – 2 = número de subredes.**

O bien:
**2ᵇ – 2 = número de subredes.**

En nuestro caso disponemos de 16 – 2 = 14 direcciones de subred. Como se nos pedían 9, eso significa que nos sobrarán 5. Por supuesto, tal hecho no es ningún problema, tomaremos las nueve primeras direcciones para segmentar nuestra red y dejaremos las siguientes para posibles ampliaciones.

Evidentemente, las 9 combinaciones que seleccionaremos de los bits dedicados a subred han de integrarse en la estructura de octetos con que se indican las direcciones IP. De modo que tendremos la siguiente tabla de direcciones IP para las subredes.

**Direcciones IP de subred en binario**
```
01001011 0001 0000 00000000 00000000
01001011 0010 0000 00000000 00000000
01001011 0011 0000 00000000 00000000
01001011 0100 0000 00000000 00000000
01001011 0101 0000 00000000 00000000
01001011 0110 0000 00000000 00000000
01001011 0111 0000 00000000 00000000
01001011 1000 0000 00000000 00000000
01001011 1001 0000 00000000 00000000
```

En el segundo octeto hemos separado, por claridad, la parte dedicada a subred y la parte dedicada a host, aunque el octeto siempre se toma como un único valor numérico.

Vea a continuación la misma tabla expresada en decimal, como es más habitual.

**Direcciones IP de subred en decimal**
```
75 16  0 0
75 32  0 0
75 48  0 0
75 64  0 0
75 80  0 0
75 96  0 0
75 112 0 0
75 128 0 0
75 144 0 0
```

Observe que en el segundo octeto los valores se incrementan en la cantidad constante de 16 unidades. En todas las segmentaciones con máscaras de longitud fija ocurre lo mismo. Esto puede resultarle útil para calcular más rápidamente.

Para completar la resolución de un problema de segmentación se ha de facilitar: la máscara de las subredes, la dirección del primer y del último host de cada subred (obteniendo así el intervalo de direcciones disponibles para cada subred), las direcciones de difusión y el número de direcciones para host disponibles en cada subred.

La máscara de todas las subredes es común. Se obtiene poniendo a uno todos los bits dedicados a dirección de red y subred y a cero los dedicados a host.

**Máscara de subred en binario**
```
11111111 11110000 00000000 00000000
```

**Máscara de subred en decimal**
```
255 240 0 0
```

Cada dirección de subred queda determinada por la IP y su máscara. No tiene sentido hablar de la dirección de subred 75.32.0.0, sino de la dirección de subred 75.32.0.0 con máscara 240.0.0.0; o bien, en notación abreviada, de la dirección de subred 75.32.0.0/12, donde 12 indica el número total de bits dedicados a direccionamiento de red.

En la siguiente tabla se completa la información sobre el direccionamiento para la segmentación solicitada.

| Dirección de subred | Primer host | Último host     | Dirección de difusión |
|--------------------|-------------|-----------------|----------------------|
| 75.16.0.0          | 75.16.0.1   | 75.31.255.254   | 75.31.255.255        |
| 75.32.0.0          | 75.32.0.1   | 75.47.255.254   | 75.47.255.255        |
| 75.48.0.0          | 75.48.0.1   | 75.63.255.254   | 75.63.255.255        |
| 75.64.0.0          | 75.64.0.1   | 75.79.255.254   | 75.79.255.255        |
| 75.80.0.0          | 75.80.0.1   | 75.95.255.254   | 75.95.255.255        |
| 75.96.0.0          | 75.96.0.1   | 75.111.255.254  | 75.111.255.255       |
| 75.112.0.0         | 75.112.0.1  | 75.127.255.254  | 75.127.255.255       |
| 75.128.0.0         | 75.128.0.1  | 75.143.255.254  | 75.143.255.255       |
| 75.144.0.0         | 75.144.0.1  | 75.159.255.254  | 75.159.255.255       |

Observe que la dirección de difusión o broadcast es la que lleva todos los bits dedicados a la parte de host a uno. Por ejemplo, para la primera subred, la dirección de difusión en binario se expresaría como:

**Dirección IP de difusión para la primera subred**

| Red      | Subred | Host                     |
|----------|--------|--------------------------|
| 01001011 | 0001   | 1111 11111111 11111111   |
| 75       | 31     | 255 255                  |

Fíjese que este valor es el inmediatamente anterior a la IP de la segunda subred:

**Dirección IP de la segunda subred**

| Red      | Subred | Host                   |
|----------|--------|------------------------|
| 01001011 | 0010   | 0000 00000000 00000000 |
| 75       | 32     | 0 0                    |

De modo que para obtener las direcciones de difusión, en lugar de convertir su expresión binaria a decimal, resulta más cómodo ver la siguiente dirección de red y restar una unidad. Como el valor máximo de un octeto es 255, el valor por debajo de 0 es 255 y me llevo una al otro octeto. En nuestro caso, ponemos a 255 el cuarto octeto y nos llevamos una al tercero. Después, ponemos a 255 el tercer octeto y nos llevamos una al segundo. Y en el segundo le restamos una a 32. Es como una resta habitual: si a 3200 le restamos 1, colocamos la cuarta cifra en 9 (el valor máximo de las unidades) y nos llevamos una a la tercera cifra. Ponemos a 9 la tercera cifra, llevamos una a la segunda y así obtenemos 3199.

Obtener la dirección del primer host es inmediato. Para la del último host restamos una unidad a la dirección de difusión y pasamos de 255 a 254.

Para calcular el número de direcciones disponibles para hosts en cada subred, aplique la siguiente fórmula:

**Número de hosts = 2ʰ – 2,**

donde h es el número de bits dedicado a la dirección de host. Restamos dos porque la primera IP es la dirección de la red y la última es la dirección de difusión. En nuestro caso, el valor de h es 20. Por tanto:

**Número de hosts = 2²⁰ -2 = 1.048.578**

**Ejemplo 2: Segmentación de una IP de clase A usando dos octetos.**

Supongamos ahora que se nos pide dividir la misma dirección de red que en el ejemplo anterior en 600 subredes.

Primeramente, escribiremos 600 en su expresión binaria.

| Notación decimal | Notación binaria |
|------------------|------------------|
| 600              | 1001011000       |

Si en el caso anterior necesitábamos cuatro bits ahora necesitaremos diez. La diferencia es simplemente que en lugar de tomar prestados los bits de un octeto, usaremos bits de dos octetos:

| Bits de red | Bits de subred      | Bits de host |
|-------------|---------------------|--------------|
| 01001011    | ssssssss ss         | 000000 00000000 |
| Octeto 1    | Octeto 2 Octeto 3   | Octeto 4     |

Con diez bits podemos obtener un total de:

**2¹⁰ – 2 = 1024 – 2 = 1022 subredes.**

La tabla de direcciones IP para las primeras subredes quedaría:

**Direcciones IP de subred en binario**
```
01001011 00000000 01 000000 00000000
01001011 00000000 10 000000 00000000
01001011 00000000 11 000000 00000000
01001011 00000001 00 000000 00000000
01001011 00000001 01 000000 00000000
01001011 00000001 10 000000 00000000
01001011 00000001 11 000000 00000000
01001011 00000010 00 000000 00000000
01001011 00000010 01 000000 00000000
01001011 00000010 10 000000 00000000
01001011 00000010 11 000000 00000000
01001011 00000011 00 000000 00000000
... ... ... ...
```

Observe que no hemos escrito la primera combinación por no ser considerada una dirección correcta de subred, por el mismo motivo no deberíamos considerar la última. Obviamente, no vamos a listar las 600 subredes pedidas. Con ejemplificar el proceso para las primeras es suficiente, pues el patrón de valores es repetitivo. Escribamos ahora la tabla anterior en decimal.

**Direcciones IP de subred en decimal**
```
75 0 64  0
75 0 128 0
75 0 192 0
75 1 0   0
75 1 64  0
75 1 128 0
75 1 192 0
75 2 0   0
75 2 64  0
75 2 128 0
75 2 192 0
75 3 0   0
... ... ... ...
```

La tabla con la información completa para las subredes sería:

| Dirección de subred | Primer host | Último host    | Dirección de difusión |
|--------------------|-------------|----------------|----------------------|
| 75.0.64.0          | 75.0.64.1   | 75.0.127.254   | 75.0.127.255         |
| 75.0.128.0         | 75.0.128.1  | 75.0.191.254   | 75.0.191.255         |
| 75.0.192.0         | 75.0.192.1  | 75.0.255.254   | 75.0.255.255         |
| 75.1.0.0           | 75.1.0.1    | 75.1.63.254    | 75.1.63.255          |
| 75.1.64.0          | 75.1.64.1   | 75.1.127.254   | 75.1.127.255         |
| 75.1.128.0         | 75.1.128.1  | 75.1.191.254   | 75.1.191.255         |
| 75.1.192.0         | 75.1.192.1  | 75.1.255.254   | 75.1.255.255         |
| 75.2.0.0           | 75.2.0.1    | 75.2.63.254    | 75.2.63.255          |
| 75.2.64.0          | 75.2.64.1   | 75.2.127.254   | 75.2.127.255         |
| ...                | ...         | ...            | ...                  |

Para terminar el problema recuerde añadir la máscara de subred:

**Máscara de subred en binario**
```
11111111 11111111 11000000 00000000
```

**Máscara de subred en decimal**
```
255 255 192 0
```

Y dar el número de direcciones de hosts disponibles por subred:

**Número de hosts = 2¹⁴ – 2 = 16.382**

**Ejemplo 3:** Segmentación de una IP de clase A usando tres octetos. Se remite al lector a la sección 3.1 y al ejercicio 1.

### PROPUESTA DE EJERCICIOS

1. Segmente la dirección 20.0.0.0/8 empleando 18 bits para la parte de subred.

2. Obtenga subredes a partir de la IP 170.31.0.0/16 de modo que cada una de ellas disponga de 30 hosts.

3. Divida la red 192.168.0.0/24 en 7 subredes.

En los ejercicios anteriores complete la información de direccionamiento solamente para las cuatro primeras subredes.