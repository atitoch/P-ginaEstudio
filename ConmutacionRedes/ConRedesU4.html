<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unidad 2: Segmentaci√≥n de Redes - Cuestionario</title>
    <link rel="stylesheet" href="QuizRedes.css" />
  </head>
  <body>
    <div class="container">
      <a href="index.html" class="back-button"
        >‚¨Ö Volver a Conmutaci√≥n y Redes</a
      >

      <div class="breadcrumb">
        <a href="../index.html">Inicio</a> >
        <a href="index.html">Conmutaci√≥n y Redes</a> > Unidad 2: Segmentaci√≥n de
        Redes
      </div>

      <div class="header">
        <h1>üîÑ Unidad 2: Segmentaci√≥n de Redes</h1>
        <p>
          Conceptos de Segmentaci√≥n, Switches, VLANs, VTP y C√°lculo de Subredes
        </p>
      </div>

      <div id="loadingMessage" class="loading">
        <h3>Cargando preguntas...</h3>
        <p>
          Por favor espera mientras se cargan las preguntas del cuestionario.
        </p>
      </div>

      <div id="errorMessage" class="error" style="display: none">
        <h3>Error al cargar las preguntas</h3>
        <p>
          No se pudo cargar el archivo U3.json. Verifica que el archivo existe y
          es v√°lido.
        </p>
      </div>

      <div class="quiz-container" id="quizContainer" style="display: none">
        <div class="quiz-progress">
          <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="question-counter">
          <span id="currentQuestion">1</span> de
          <span id="totalQuestions">0</span>
        </div>

        <div id="questionsContainer">
          <!-- Las preguntas se cargar√°n aqu√≠ din√°micamente -->
        </div>

        <div class="results">
          <h2>¬°Cuestionario Completado!</h2>
          <div class="score" id="score">0%</div>
          <div class="score-details">
            <span id="correctAnswers">0</span> respuestas correctas de
            <span id="totalQuestionsResult">0</span>
          </div>
          <button class="btn btn-primary" onclick="restartQuiz()">
            Reiniciar Cuestionario
          </button>
          <a href="index.html" class="btn btn-secondary"
            >Volver a Conmutaci√≥n y Redes</a
          >
        </div>

        <!-- Controles de navegaci√≥n -->
        <div class="controls">
          <button
            class="btn btn-secondary"
            id="prevBtn"
            onclick="previousQuestion()"
            disabled
          >
            Anterior
          </button>
          <div class="question-info">
            <button
              class="btn btn-primary"
              id="checkBtn"
              onclick="checkAnswer()"
            >
              Verificar Respuesta
            </button>
          </div>
          <button
            class="btn btn-secondary"
            id="nextBtn"
            onclick="nextQuestion()"
            disabled
          >
            Siguiente
          </button>
        </div>
      </div>
    </div>

    <script>
      let currentQuestionIndex = 0;
      let questions = [];
      let userAnswers = [];
      let correctAnswers = 0;
      let questionOrder = [];
      let originalQuestions = [];
      let quizData = null;

      // Funci√≥n para cargar el archivo JSON
      async function loadQuizData() {
        try {
          const response = await fetch("U4.json");
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Error loading quiz data:", error);
          throw error;
        }
      }

      // Funci√≥n para crear HTML de una pregunta
      function createQuestionHTML(questionData, index) {
        const questionDiv = document.createElement("div");
        questionDiv.className = "question";
        questionDiv.dataset.type = "multiple";

        let optionsHTML = "";
        questionData.options.forEach((option, optionIndex) => {
          const optionId = `q${index}_${optionIndex}`;
          const value = option.correct ? "correct" : "incorrect";

          optionsHTML += `
            <li class="option">
              <input type="radio" name="q${index}" value="${value}" id="${optionId}" />
              <label for="${optionId}">${option.text}</label>
            </li>
          `;
        });

        questionDiv.innerHTML = `
          <h3>${questionData.question}</h3>
          <ul class="options">
            ${optionsHTML}
          </ul>
          <div class="feedback"></div>
        `;

        return questionDiv;
      }

      // Funci√≥n para inicializar las preguntas desde JSON
      function initializeQuestionsFromJSON() {
        const questionsContainer =
          document.getElementById("questionsContainer");
        questionsContainer.innerHTML = "";

        quizData.quiz.questions.forEach((questionData, index) => {
          const questionElement = createQuestionHTML(questionData, index);
          questionsContainer.appendChild(questionElement);
        });

        // Actualizar las referencias a las preguntas
        questions = document.querySelectorAll(".question");

        // Actualizar contador total
        document.getElementById("totalQuestions").textContent =
          questions.length;
      }

      // Funci√≥n para mezclar un array (algoritmo Fisher-Yates)
      function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      }

      // Funci√≥n para mezclar las opciones de una pregunta
      function shuffleOptions(question) {
        const options = question.querySelectorAll(".option");
        if (options.length > 0) {
          const optionsArray = Array.from(options);
          const shuffledOptions = shuffleArray(optionsArray);
          const optionsList = question.querySelector(".options");
          optionsList.innerHTML = "";
          shuffledOptions.forEach((option) => {
            optionsList.appendChild(option);
          });
        }
      }

      // Funci√≥n para inicializar el orden aleatorio de las preguntas
      function initializeQuestionOrder() {
        questionOrder = Array.from({ length: questions.length }, (_, i) => i);
        questionOrder = shuffleArray(questionOrder);
        originalQuestions = Array.from(questions);

        originalQuestions.forEach((question) => {
          shuffleOptions(question);
        });
      }

      // Funci√≥n para obtener la pregunta actual basada en el orden aleatorio
      function getCurrentQuestion() {
        const actualIndex = questionOrder[currentQuestionIndex];
        return originalQuestions[actualIndex];
      }

      // Inicializar el cuestionario
      async function initializeApp() {
        try {
          // Mostrar mensaje de carga
          document.getElementById("loadingMessage").style.display = "block";
          document.getElementById("errorMessage").style.display = "none";
          document.getElementById("quizContainer").style.display = "none";

          // Cargar datos del JSON
          quizData = await loadQuizData();

          // Crear preguntas desde JSON
          initializeQuestionsFromJSON();

          // Inicializar quiz
          initializeQuiz();

          // Mostrar contenedor del quiz
          document.getElementById("loadingMessage").style.display = "none";
          document.getElementById("quizContainer").style.display = "block";
        } catch (error) {
          console.error("Error initializing app:", error);
          document.getElementById("loadingMessage").style.display = "none";
          document.getElementById("errorMessage").style.display = "block";
        }
      }

      function initializeQuiz() {
        userAnswers = new Array(questions.length).fill(null);
        currentQuestionIndex = 0;
        correctAnswers = 0;

        initializeQuestionOrder();

        document.querySelector(".results").style.display = "none";
        showQuestion(0);
        updateProgress();
      }

      function showQuestion(index) {
        originalQuestions.forEach((q) => {
          q.classList.remove("active");
        });

        const currentQuestion = getCurrentQuestion();
        if (currentQuestion) {
          currentQuestion.classList.add("active");
        }

        document.getElementById("currentQuestion").textContent = index + 1;
        updateButtons();
        updateProgress();
      }

      function updateButtons() {
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const checkBtn = document.getElementById("checkBtn");

        prevBtn.disabled = currentQuestionIndex === 0;

        if (currentQuestionIndex === questions.length - 1) {
          nextBtn.textContent = "Ver Resultados";
          nextBtn.disabled = false;
        } else {
          nextBtn.textContent = "Siguiente";
          nextBtn.disabled = userAnswers[currentQuestionIndex] === null;
        }

        if (userAnswers[currentQuestionIndex] !== null) {
          checkBtn.style.display = "none";
          nextBtn.disabled = false;
        } else {
          checkBtn.style.display = "inline-block";
        }
      }

      function updateProgress() {
        const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
        document.getElementById("progressBar").style.width = progress + "%";
      }

      function previousQuestion() {
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          showQuestion(currentQuestionIndex);
        }
      }

      function nextQuestion() {
        if (currentQuestionIndex < questions.length - 1) {
          currentQuestionIndex++;
          showQuestion(currentQuestionIndex);
        } else {
          showResults();
        }
      }

      function checkAnswer() {
        const currentQuestion = getCurrentQuestion();
        const selectedOption = currentQuestion.querySelector(
          'input[type="radio"]:checked'
        );

        if (!selectedOption) {
          alert("Por favor selecciona una respuesta");
          return;
        }

        const userAnswer = selectedOption.value;
        const isCorrect = selectedOption.value === "correct";

        // Mostrar feedback visual
        const options = currentQuestion.querySelectorAll(".option");
        options.forEach((option) => {
          const input = option.querySelector('input[type="radio"]');
          if (input.value === "correct") {
            option.classList.add("correct");
          } else if (input.checked && input.value === "incorrect") {
            option.classList.add("incorrect");
          }
        });

        // Guardar respuesta
        userAnswers[currentQuestionIndex] = {
          answer: userAnswer,
          correct: isCorrect,
        };

        if (isCorrect) {
          correctAnswers++;
        }

        showFeedback(isCorrect);
        updateButtons();
      }

      function showFeedback(isCorrect) {
        const currentQuestion = getCurrentQuestion();
        const feedback = currentQuestion.querySelector(".feedback");
        const actualIndex = questionOrder[currentQuestionIndex];
        const questionData = quizData.quiz.questions[actualIndex];

        feedback.style.display = "block";
        feedback.className =
          "feedback " + (isCorrect ? "correct" : "incorrect");

        if (isCorrect) {
          feedback.innerHTML = `
      <strong>¬°Correcto! üéâ</strong><br>
      Excelente trabajo. Has seleccionado la respuesta correcta.
      ${
        questionData.feedback ? `<br><br><em>${questionData.feedback}</em>` : ""
      }
    `;
        } else {
          // Encontrar la respuesta correcta
          const correctOption = currentQuestion.querySelector(
            'input[value="correct"]'
          );
          const correctLabel = correctOption
            ? correctOption.nextElementSibling.textContent
            : "No encontrada";

          feedback.innerHTML = `
      <strong>Incorrecto ‚ùå</strong><br>
      La respuesta correcta es: <strong>"${correctLabel}"</strong><br>
      <em>Te recomendamos revisar el material de estudio para reforzar este concepto.</em>
      ${
        questionData.feedback
          ? `<br><br><strong>Explicaci√≥n:</strong> ${questionData.feedback}`
          : ""
      }
    `;
        }
      }

      function showResults() {
        const currentQuestion = getCurrentQuestion();
        currentQuestion.classList.remove("active");

        const resultsDiv = document.querySelector(".results");
        resultsDiv.style.display = "block";

        const percentage = Math.round(
          (correctAnswers / questions.length) * 100
        );

        document.getElementById("score").textContent = percentage + "%";
        document.getElementById("correctAnswers").textContent = correctAnswers;
        document.getElementById("totalQuestionsResult").textContent =
          questions.length;

        document.querySelector(".controls").style.display = "none";
        document.querySelector(".question-counter").style.display = "none";
        document.querySelector(".quiz-progress").style.display = "none";
      }

      function restartQuiz() {
        correctAnswers = 0;
        userAnswers = new Array(questions.length).fill(null);
        currentQuestionIndex = 0;

        originalQuestions.forEach((question) => {
          question.classList.remove("active");

          const options = question.querySelectorAll(".option");
          options.forEach((option) => {
            option.classList.remove("correct", "incorrect");
          });

          const radios = question.querySelectorAll('input[type="radio"]');
          radios.forEach((radio) => {
            radio.checked = false;
          });

          const feedback = question.querySelector(".feedback");
          feedback.style.display = "none";
        });

        document.querySelector(".controls").style.display = "flex";
        document.querySelector(".question-counter").style.display = "block";
        document.querySelector(".quiz-progress").style.display = "block";

        initializeQuiz();
      }

      // Keyboard navigation
      document.addEventListener("keydown", function (e) {
        if (e.key === "ArrowLeft" && currentQuestionIndex > 0) {
          previousQuestion();
        } else if (
          e.key === "ArrowRight" &&
          currentQuestionIndex < questions.length - 1
        ) {
          nextQuestion();
        } else if (e.key === "Enter") {
          const checkBtn = document.getElementById("checkBtn");
          if (checkBtn.style.display !== "none") {
            checkAnswer();
          } else {
            nextQuestion();
          }
        }
      });

      // Inicializar la aplicaci√≥n cuando se carga la p√°gina
      document.addEventListener("DOMContentLoaded", initializeApp);
    </script>
  </body>
</html>
